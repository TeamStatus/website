var Holder=Holder||{};!function(t,e){function i(t,e){var i="complete",n="readystatechange",o=!1,r=o,a=!0,s=t.document,d=s.documentElement,l=s.addEventListener?"addEventListener":"attachEvent",u=s.addEventListener?"removeEventListener":"detachEvent",c=s.addEventListener?"":"on",g=function(a){(a.type!=n||s.readyState==i)&&(("load"==a.type?t:s)[u](c+a.type,g,o),!r&&(r=!0)&&e.call(t,null))},h=function(){try{d.doScroll("left")}catch(t){return setTimeout(h,50),void 0}g("poll")};if(s.readyState==i)e.call(t,"lazy");else{if(s.createEventObject&&d.doScroll){try{a=!t.frameElement}catch(m){}a&&h()}s[l](c+"DOMContentLoaded",g,o),s[l](c+n,g,o),t[l](c+"load",g,o)}}function n(t){t=t.match(/^(\W)?(.*)/);var e=document["getElement"+(t[1]?"#"==t[1]?"ById":"sByClassName":"sByTagName")](t[2]),i=[];return null!==e&&(i=e.length?e:0===e.length?e:[e]),i}function o(t,e){var i={};for(var n in t)t.hasOwnProperty(n)&&(i[n]=t[n]);for(var n in e)e.hasOwnProperty(n)&&(i[n]=e[n]);return i}function r(t,e,i){e=parseInt(e,10),t=parseInt(t,10);var n=Math.max(e,t),o=Math.min(e,t),r=1/12,a=Math.min(.75*o,.75*n*r);return{height:Math.round(Math.max(i.size,a))}}function a(t){var e=t.ctx,i=t.dimensions,n=t.template,o=t.ratio,a=t.holder,s="literal"==a.textmode,d="exact"==a.textmode,l=r(i.width,i.height,n),u=l.height,c=i.width*o,g=i.height*o,m=n.font?n.font:"sans-serif";h.width=c,h.height=g,e.textAlign="center",e.textBaseline="middle",e.fillStyle=n.background,e.fillRect(0,0,c,g),e.fillStyle=n.foreground,e.font="bold "+u+"px "+m;var f=n.text?n.text:Math.floor(i.width)+"x"+Math.floor(i.height);if(s){var i=a.dimensions;f=i.width+"x"+i.height}else if(d&&a.exact_dimensions){var i=a.exact_dimensions;f=Math.floor(i.width)+"x"+Math.floor(i.height)}var p=e.measureText(f).width;return p/c>=.75&&(u=Math.floor(.75*u*(c/p))),e.font="bold "+u*o+"px "+m,e.fillText(f,c/2,g/2,c),h.toDataURL("image/png")}function s(t,e,i,n){var r=i.dimensions,s=i.theme,d=i.text?decodeURIComponent(i.text):i.text,u=r.width+"x"+r.height;s=d?o(s,{text:d}):s,s=i.font?o(s,{font:i.font}):s,e.setAttribute("data-src",n),i.theme=s,e.holder_data=i,"image"==t?(e.setAttribute("alt",d?d:s.text?s.text+" ["+u+"]":u),(g||!i.auto)&&(e.style.width=r.width+"px",e.style.height=r.height+"px"),g?e.style.backgroundColor=s.background:(e.setAttribute("src",a({ctx:w,dimensions:r,template:s,ratio:x,holder:i})),i.textmode&&"exact"==i.textmode&&(p.push(e),l(e)))):"background"==t?g||(e.style.backgroundImage="url("+a({ctx:w,dimensions:r,template:s,ratio:x,holder:i})+")",e.style.backgroundSize=r.width+"px "+r.height+"px"):"fluid"==t&&(e.setAttribute("alt",d?d:s.text?s.text+" ["+u+"]":u),e.style.height="%"==r.height.slice(-1)?r.height:r.height+"px",e.style.width="%"==r.width.slice(-1)?r.width:r.width+"px",("inline"==e.style.display||""===e.style.display||"none"==e.style.display)&&(e.style.display="block"),g?e.style.backgroundColor=s.background:(p.push(e),l(e)))}function d(t,e){var i={height:t.clientHeight,width:t.clientWidth};if(!i.height&&!i.width){if(t.hasAttribute("data-holder-invisible"))throw new Error("Holder: placeholder is not visible");return t.setAttribute("data-holder-invisible",!0),setTimeout(function(){e.call(this,t)},1),null}return t.removeAttribute("data-holder-invisible"),i}function l(t){var e;e=null==t.nodeType?p:[t];for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];if(n.holder_data){var o=n.holder_data,r=d(n,l);r&&(o.fluid&&n.setAttribute("src",a({ctx:w,dimensions:r,template:o.theme,ratio:x,holder:o})),o.textmode&&"exact"==o.textmode&&(o.exact_dimensions=r,n.setAttribute("src",a({ctx:w,dimensions:o.dimensions,template:o.theme,ratio:x,holder:o}))))}}}function u(e,i){var n={theme:o(b.themes.gray,{})},r=!1;for(sl=e.length,j=0;sl>j;j++){var a=e[j];t.flags.dimensions.match(a)?(r=!0,n.dimensions=t.flags.dimensions.output(a)):t.flags.fluid.match(a)?(r=!0,n.dimensions=t.flags.fluid.output(a),n.fluid=!0):t.flags.textmode.match(a)?n.textmode=t.flags.textmode.output(a):t.flags.colors.match(a)?n.theme=t.flags.colors.output(a):i.themes[a]?i.themes.hasOwnProperty(a)&&(n.theme=o(i.themes[a],{})):t.flags.font.match(a)?n.font=t.flags.font.output(a):t.flags.auto.match(a)?n.auto=!0:t.flags.text.match(a)&&(n.text=t.flags.text.output(a))}return r?n:!1}var c=!1,g=!1,h=document.createElement("canvas"),m=1,f=1,p=[];if(h.getContext)if(h.toDataURL("image/png").indexOf("data:image/png")<0)g=!0;else var w=h.getContext("2d");else g=!0;g||(m=window.devicePixelRatio||1,f=w.webkitBackingStorePixelRatio||w.mozBackingStorePixelRatio||w.msBackingStorePixelRatio||w.oBackingStorePixelRatio||w.backingStorePixelRatio||1);var x=m/f,b={domain:"holder.js",images:"img",bgnodes:".holderjs",themes:{gray:{background:"#eee",foreground:"#aaa",size:12},social:{background:"#3a5a97",foreground:"#fff",size:12},industrial:{background:"#434A52",foreground:"#C2F200",size:12},sky:{background:"#0D8FDB",foreground:"#fff",size:12},vine:{background:"#39DBAC",foreground:"#1E292C",size:12},lava:{background:"#F8591A",foreground:"#1C2846",size:12}},stylesheet:""};t.flags={dimensions:{regex:/^(\d+)x(\d+)$/,output:function(t){var e=this.regex.exec(t);return{width:+e[1],height:+e[2]}}},fluid:{regex:/^([0-9%]+)x([0-9%]+)$/,output:function(t){var e=this.regex.exec(t);return{width:e[1],height:e[2]}}},colors:{regex:/#([0-9a-f]{3,})\:#([0-9a-f]{3,})/i,output:function(t){var e=this.regex.exec(t);return{size:b.themes.gray.size,foreground:"#"+e[2],background:"#"+e[1]}}},text:{regex:/text\:(.*)/,output:function(t){return this.regex.exec(t)[1]}},font:{regex:/font\:(.*)/,output:function(t){return this.regex.exec(t)[1]}},auto:{regex:/^auto$/},textmode:{regex:/textmode\:(.*)/,output:function(t){return this.regex.exec(t)[1]}}},document.getElementsByClassName||(document.getElementsByClassName=function(t){var e,i,n,o=document,r=[];if(o.querySelectorAll)return o.querySelectorAll("."+t);if(o.evaluate)for(i=".//*[contains(concat(' ', @class, ' '), ' "+t+" ')]",e=o.evaluate(i,o,null,0,null);n=e.iterateNext();)r.push(n);else for(e=o.getElementsByTagName("*"),i=new RegExp("(^|\\s)"+t+"(\\s|$)"),n=0;n<e.length;n++)i.test(e[n].className)&&r.push(e[n]);return r}),window.getComputedStyle||(window.getComputedStyle=function(t){return this.el=t,this.getPropertyValue=function(e){var i=/(\-([a-z]){1})/g;return"float"==e&&(e="styleFloat"),i.test(e)&&(e=e.replace(i,function(){return arguments[2].toUpperCase()})),t.currentStyle[e]?t.currentStyle[e]:null},this}),Object.prototype.hasOwnProperty||(Object.prototype.hasOwnProperty=function(t){var e=this.__proto__||this.constructor.prototype;return t in this&&(!(t in e)||e[t]!==this[t])});for(var y in t.flags)t.flags.hasOwnProperty(y)&&(t.flags[y].match=function(t){return t.match(this.regex)});t.add_theme=function(e,i){return null!=e&&null!=i&&(b.themes[e]=i),t},t.add_image=function(e,i){var o=n(i);if(o.length)for(var r=0,a=o.length;a>r;r++){var s=document.createElement("img");s.setAttribute("data-src",e),o[r].appendChild(s)}return t},t.run=function(e){c=!0;var i=o(b,e),r=[],a=[],d=[];for("string"==typeof i.images?a=n(i.images):window.NodeList&&i.images instanceof window.NodeList?a=i.images:window.Node&&i.images instanceof window.Node&&(a=[i.images]),"string"==typeof i.bgnodes?d=n(i.bgnodes):window.NodeList&&i.elements instanceof window.NodeList?d=i.bgnodes:window.Node&&i.bgnodes instanceof window.Node&&(d=[i.bgnodes]),m=0,h=a.length;h>m;m++)r.push(a[m]);var l=document.getElementById("holderjs-style");l||(l=document.createElement("style"),l.setAttribute("id","holderjs-style"),l.type="text/css",document.getElementsByTagName("head")[0].appendChild(l)),i.nocss||(l.styleSheet?l.styleSheet.cssText+=i.stylesheet:l.appendChild(document.createTextNode(i.stylesheet)));for(var g=new RegExp(i.domain+'/(.*?)"?\\)'),h=d.length,m=0;h>m;m++){var f=window.getComputedStyle(d[m],null).getPropertyValue("background-image"),p=f.match(g),w=d[m].getAttribute("data-background-src");if(p){var x=u(p[1].split("/"),i);x&&s("background",d[m],x,f)}else if(null!=w){var x=u(w.substr(w.lastIndexOf(i.domain)+i.domain.length+1).split("/"),i);x&&s("background",d[m],x,f)}}for(h=r.length,m=0;h>m;m++){var y,v;v=y=f=null;try{v=r[m].getAttribute("src"),attr_datasrc=r[m].getAttribute("data-src")}catch(C){}if(null==attr_datasrc&&v&&v.indexOf(i.domain)>=0?f=v:attr_datasrc&&attr_datasrc.indexOf(i.domain)>=0&&(f=attr_datasrc),f){var x=u(f.substr(f.lastIndexOf(i.domain)+i.domain.length+1).split("/"),i);x&&(x.fluid?s("fluid",r[m],x,f):s("image",r[m],x,f))}}return t},i(e,function(){window.addEventListener?(window.addEventListener("resize",l,!1),window.addEventListener("orientationchange",l,!1)):window.attachEvent("onresize",l),c||t.run()}),"function"==typeof define&&define.amd&&define([],function(){return t})}(Holder,window);var BambooBuildsCtrl=["$scope",function(){}],JiraCounterCtrl=["$scope",function(){}],JiraSimpleCounterCtrl=["$scope",function(){}],JiraSimpleCounterCtrl=["$scope",function(){}],StaticHtmlCtrl=["$scope",function(){}],con=angular.module("teamstatus.console",["ngRoute","angular-underscore","frapontillo.ex.filters"]).constant("path","").constant("partials","/partials");angular.module("teamstatus.console.widget",["teamstatus.console"]).directive("bsHolder",function(){return{link:function(t,e){Holder.run({images:e.get(0)})}}}).factory("board",["$document",function(){return{editUrl:angular.element('meta[name="ts.board.editUrl"]').attr("content"),publicId:angular.element('meta[name="ts.board.publicId"]').attr("content"),boardId:angular.element('meta[name="ts.board.id"]').attr("content")}}]).factory("widgets",["$http",function(){return[{name:"Clock",id:"clock",description:"Add a clock",widgetSettings:{title:"Clock"}},{name:"STFU",id:"stfu",description:"Tell your team to be quiet",widgetSettings:{title:"Shhh..."}},{name:"Bamboo Builds",id:"bamboo-builds",description:"Get Bamboo Builds status",configurable:!0,widgetSettings:{title:"Builds"}},{name:"JIRA Counter",id:"jira-simple-counter",description:"Display number of issues in JIRA",configurable:!0,widgetSettings:{title:"Issues"}},{name:"JIRA Issues",id:"jira-issue-list",description:"Display list of issues from JIRA",configurable:!0,widgetSettings:{title:"Issues"}},{name:"Static HTML",id:"static-html",description:"Display static HTML",configurable:!0,widgetSettings:{title:"HTML"}}]}]),angular.module("teamstatus.console.widget.add",["teamstatus.console.widget"]).config(["$routeProvider","partials",function(t,e){t.when("/welcome",{templateUrl:e+"/new_widget_welcome"}).when("/:id",{templateUrl:e+"/new_widget_form",controller:"WidgetCtrl"}).otherwise({redirectTo:"/welcome"})}]),angular.module("teamstatus.console.widget.edit",["teamstatus.console.widget"]).config(["$routeProvider","partials",function(t,e){t.when("/:id",{templateUrl:e+"/new_widget_form",controller:"WidgetCtrl"})}]);var WidgetsCtrl=["$scope","$routeParams","$log","$http","$window","partials","widgets","board",function(t,e,i,n,o,r,a,s){function d(){var i=t.widgets,n=e.id;_.each(i,function(e){e.active=!!e.id&&e.id===n,e.active&&(t.currentWidget=e,t.$broadcast("currentWidgetChanged",t.currentWidget))})}t.widgets=a,t.board=s,t.$on("$routeChangeSuccess",d),d()}],EditWidgetsCtrl=["$scope","$routeParams","$log","$http","$window","path","widgets","board",function(t,e,i,n,o,r,a,s){function d(){var i=e.id;_.each(t.boardWidgets,function(e){e.active=!!e._id&&e._id===i,e.active&&(t.currentWidget=_.extend(_.clone(t.widgetsMap[e.widget]),e),t.$broadcast("currentWidgetChanged",t.currentWidget))})}t.editing=!0,t.widgetsMap=_.indexBy(a,"id"),t.board=s,t.$on("$routeChangeSuccess",d),n.get(r+"/boards/"+s.boardId+"/widgets.json").success(function(e){t.boardWidgets=e,d()})}],WidgetCtrl=["$scope","$http","$compile","$window","partials","widgets","board","path",function(t,e,i,n,o,r,a,s){function d(n){t.settings=n.settings||{},t.widgetSettings=n.widgetSettings||{title:"Widget"},n.configurable&&e.get(o+"/integrations/"+n.id).success(function(e){t.settings=n.settings||{},angular.element(".settings").html(i(e)(t))})}t.$on("currentWidgetChanged",function(t,e){d(e)}),void 0!==t.currentWidget&&d(t.currentWidget),t.addWidget=function(){t.editing?e.put(s+"/boards/"+t.board.boardId+"/widgets/"+t.currentWidget._id+".json",{settings:t.settings,widgetSettings:t.widgetSettings}).success(function(e){e.error||(n.location.href=t.board.editUrl)}):e.post(s+"/boards/"+t.board.boardId+"/widgets.json",{widget:t.currentWidget.id,settings:t.settings,widgetSettings:t.widgetSettings}).success(function(e){e.error||(n.location.href=t.board.editUrl)})}}];