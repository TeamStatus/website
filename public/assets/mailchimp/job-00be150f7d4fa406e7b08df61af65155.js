var async=require("async"),qs=require("querystring");module.exports=function(e,r,t){var l=e.authName||"jac";if(!(e.globalAuth&&e.globalAuth[l]&&e.globalAuth[l].username&&e.globalAuth[l].password))return t("no JIRA credentials found in buildoverview job. Please check global authentication file");if(!e.jiraServer)return t("No JIRA server configured");var n=r.logger,a=e.jiraServer+"/rest/api/2/search?",i=e.jiraServer+"/issues/?",s={headers:{authorization:"Basic "+new Buffer(e.globalAuth[l].username+":"+e.globalAuth[l].password).toString("base64")}};async.map(e.sections,function(e,t){async.map(e.counts,function(e,t){return e.jql&&e.jql.trim().length?(s.url=a+qs.stringify({jql:e.jql,maxResults:200}),r.easyRequest.JSON(s,function(r,l){r?(n.error(r),t(r)):t(null,{label:e.label,count:l.issues.length,url:i+qs.stringify({jql:e.jql})})}),void 0):t(null,{label:e.label,count:0})},function(r,l){t(r,{title:e.title,counts:l})})},function(r,l){t(r,{title:e.title,sections:l})})};